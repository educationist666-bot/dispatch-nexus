{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-white mb-1">Nexus HQ Control</h1>
            <p class="text-white-50">Global Oversight & User Management</p>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card p-4 border-0 bg-dark shadow-lg">
                <small class="text-uppercase text-white-50 fw-bold">Active Clients</small>
                <h2 class="text-white display-6 fw-bold mt-2">{{ stats.total_clients }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-4 border-0 bg-dark shadow-lg" style="border-left: 4px solid #10b981 !important;">
                <small class="text-uppercase text-white-50 fw-bold">Monthly Revenue (MRR)</small>
                <h2 class="text-success display-6 fw-bold mt-2">${{ stats.mrr }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-4 border-0 bg-dark shadow-lg">
                <small class="text-uppercase text-white-50 fw-bold">Pending Approval</small>
                <h2 class="text-warning display-6 fw-bold mt-2">{{ stats.pending_count }}</h2>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-lg mb-5">
        <div class="card-header py-3 border-bottom border-secondary border-opacity-25">
            <h5 class="text-white mb-0"><i class="fas fa-hourglass-half text-warning me-2"></i> Pending Requests</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-dark align-middle mb-0">
                <thead>
                    <tr>
                        <th class="ps-4">Company (Username)</th>
                        <th>Plan</th>
                        <th>Receipt</th>
                        <th class="text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in pending %}
                    <tr>
                        <td class="ps-4">
                            <span class="fw-bold d-block">{{ c.name }}</span>
                            <small class="text-primary">User: {{ c.owner.username }}</small> </td>
                        <td><span class="badge bg-primary text-uppercase">{{ c.plan_type }}</span></td>
                        <td><a href="{{ c.payment_receipt.url }}" target="_blank" class="btn btn-sm btn-outline-info">View</a></td>
                        <td class="text-end pe-4">
                            <a href="{% url 'approve_company' c.id %}" class="btn btn-sm btn-success rounded-pill px-3">Approve</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="card border-0 shadow-lg">
        <div class="card-header py-3 border-bottom border-secondary border-opacity-25">
            <h5 class="text-white mb-0"><i class="fas fa-check-circle text-success me-2"></i> Active Subscriber Database</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-dark align-middle mb-0">
                <thead>
                    <tr>
                        <th class="ps-4">Company (Username)</th>
                        <th>Days Left</th>
                        <th>Adjust Access</th>
                        <th class="text-end pe-4">Controls</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in active %}
                    <tr>
                        <td class="ps-4">
                            <span class="fw-bold d-block">{{ c.name }}</span>
                            <small class="text-primary">User: {{ c.owner.username }}</small> </td>
                        <td>
                            <span class="badge bg-opacity-10 {% if c.days_remaining < 5 %}bg-danger text-danger{% else %}bg-success text-success{% endif %}">
                                {{ c.days_remaining }} Days
                            </span>
                        </td>
                        <td>
                            <form action="{% url 'edit_access_days' c.id %}" method="POST" class="d-flex gap-2">
                                {% csrf_token %}
                                <input type="number" name="days" placeholder="+/- Days" class="form-control form-control-sm w-50 bg-dark text-white border-secondary">
                                <button type="submit" class="btn btn-sm btn-primary">Update</button>
                            </form>
                        </td>
                        <td class="text-end pe-4">
                            <a href="{% url 'pause_company' c.id %}" class="btn btn-sm btn-warning rounded-circle" title="Pause"><i class="fas fa-pause"></i></a>
                            <a href="{% url 'delete_company' c.id %}" class="btn btn-sm btn-danger rounded-circle ms-2" onclick="return confirm('Full Delete?')" title="Delete"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}